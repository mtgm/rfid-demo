<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <title>RFID 3D Konfigüratör</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{margin:0;background:#0b0d12;color:#e9eef5;font-family:sans-serif;display:flex;flex-direction:column;min-height:100vh}
    header{padding:10px 16px;border-bottom:1px solid #1d2230;background:#0f121a;display:flex;align-items:center}
    header h1{font-size:16px;margin:0;font-weight:600}
    #viewer{flex:1;position:relative}
    #canvasContainer{position:absolute;inset:0}
    .toolbar{padding:12px 16px;border-top:1px solid #1d2230;background:#0f121a;display:flex;gap:12px;flex-wrap:wrap}
    .card{border:1px dashed #2a3650;border-radius:8px;padding:8px 10px;background:#0b0f1a}
    .btn{border:1px solid #2a3650;background:#111827;color:#e9eef5;padding:6px 10px;border-radius:6px;cursor:pointer}
    .btn:hover{background:#172036}
    .input{border:1px solid #2a3650;background:#0b0f1a;color:#e9eef5;padding:6px 10px;border-radius:6px}
    .diagBox{position:absolute;left:12px;bottom:12px;background:rgba(15,18,26,.9);border:1px solid #2a3650;border-radius:6px;padding:6px 10px;font-size:12px}
  </style>

  <!-- Import map -->
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js?v=10"
    }
  }
  </script>
</head>
<body>
  <header><h1>RFID 3D Konfigüratör</h1></header>
  <div id="viewer">
    <div id="canvasContainer"></div>
    <div id="diagBox" class="diagBox">Hazır.</div>
  </div>

  <div class="toolbar">
    <div class="card">
      <div>UID Girişi</div>
      <input id="uidInput" class="input" placeholder="ör. 0001234567" />
      <button id="applyUid" class="btn">Uygula</button>
    </div>
    <div class="card">
      <div>ALT PANEL</div>
      <button class="btn" data-part="alt_panel" data-mat="walnut">Ceviz</button>
      <button class="btn" data-part="alt_panel" data-mat="oak">Meşe</button>
      <button class="btn" data-part="alt_panel" data-mat="white">Beyaz</button>
    </div>
    <div class="card">
      <div>ÜST PANEL</div>
      <button class="btn" data-part="ust_panel" data-mat="walnut">Ceviz</button>
      <button class="btn" data-part="ust_panel" data-mat="oak">Meşe</button>
      <button class="btn" data-part="ust_panel" data-mat="white">Beyaz</button>
    </div>
    <div class="card">
      <div>SOL PANEL</div>
      <button class="btn" data-part="sol_panel" data-mat="walnut">Ceviz</button>
      <button class="btn" data-part="sol_panel" data-mat="oak">Meşe</button>
      <button class="btn" data-part="sol_panel" data-mat="white">Beyaz</button>
    </div>
    <div class="card">
      <div>SAĞ PANEL</div>
      <button class="btn" data-part="sag_panel" data-mat="walnut">Ceviz</button>
      <button class="btn" data-part="sag_panel" data-mat="oak">Meşe</button>
      <button class="btn" data-part="sag_panel" data-mat="white">Beyaz</button>
    </div>
  </div>

  <script type="module">
    import * as THREE from "three";
    import { GLTFLoader } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js?v=10";
    import { MeshoptDecoder } from "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/libs/meshopt_decoder.module.js?v=10";

    const MODEL_PATH = "assets/model.glb?v=10";  // gerekirse dolap.glb yap
    const MATERIAL_COLORS = { walnut:0x8b5a2b, oak:0xb88a55, white:0xeeeeee };
    const partTargets = { alt_panel:[], ust_panel:[], sol_panel:[], sag_panel:[] };

    let scene, camera, renderer, root;
    const container = document.getElementById('canvasContainer');
    const diagBox = document.getElementById('diagBox');
    const log = m=>{ diagBox.textContent = m; console.log(m); };

    init3D();
    await loadModel();
    animate();

    function init3D(){
      scene = new THREE.Scene();
      const {w,h} = {w:window.innerWidth, h:window.innerHeight-180};
      camera = new THREE.PerspectiveCamera(50,w/h,0.01,5000);
      camera.position.set(0,1.2,3);

      renderer = new THREE.WebGLRenderer({antialias:true});
      renderer.setSize(w,h);
      container.appendChild(renderer.domElement);

      scene.add(new THREE.DirectionalLight(0xffffff,1).position.set(3,4,5));
      scene.add(new THREE.AmbientLight(0xffffff,0.6));
    }

    async function loadModel(){
      try{
        log("Model yükleniyor…");
        const loader = new GLTFLoader();
        loader.setMeshoptDecoder(MeshoptDecoder);

        const gltf = await loader.loadAsync(MODEL_PATH);
        root = gltf.scene;
        scene.add(root);

        root.traverse(o=>{
          if(o.isMesh){
            const n=(o.name||"").toLowerCase();
            if(n.includes("alt")) partTargets.alt_panel.push(o);
            if(n.includes("ust")) partTargets.ust_panel.push(o);
            if(n.includes("sol")) partTargets.sol_panel.push(o);
            if(n.includes("sag")) partTargets.sag_panel.push(o);
          }
        });
        log("Hazır.");
      }catch(e){ log("MODEL YÜKLENEMEDİ → "+e.message); }
    }

    function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera); }

    function applyPart(part,matKey){
      const col = MATERIAL_COLORS[matKey]||0xcccccc;
      const mat = new THREE.MeshStandardMaterial({color:col});
      partTargets[part].forEach(m=>m.material=mat);
      log(`${part} → ${matKey}`);
    }

    document.querySelectorAll('button[data-part]').forEach(btn=>{
      btn.onclick=()=>applyPart(btn.dataset.part,btn.dataset.mat);
    });

    document.getElementById('applyUid').onclick=()=>{
      const uid=document.getElementById('uidInput').value.trim();
      if(uid==="0001234567") applyPart("alt_panel","walnut");
    }
  </script>
</body>
</html>
